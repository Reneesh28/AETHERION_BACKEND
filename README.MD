# ğŸ§  AETHERION â€” Backend Architecture (Day 1 â†’ Day 5)

---

# ğŸ Current Status

**Day 1: System Bootstrap â€” âœ… Complete**
**Day 2: Market Data Simulator â€” âœ… Complete**
**Day 3: Feature Engine â€” âœ… Complete**
**Day 4: Regime Model Training (HMM) â€” âœ… Complete**
**Day 5: Live Regime Engine + WebSocket Integration â€” âœ… Complete**

AETHERION backend now runs a fully asynchronous multi-market ingestion engine with live ML-based regime detection and WebSocket broadcasting.

---

# ğŸ— System Architecture

```
Django Core (Port 8000)     â†’ MySQL (3306)
FastAPI Market (Port 8001)  â†’ MongoDB (27017)
Flask Regime (Port 8002)    â†’ HMM Model Service

FastAPI â†’ Flask (REST Communication)
FastAPI â†’ MySQL (Regime Storage)
FastAPI â†’ WebSocket (Live Streaming)
```

This establishes a microservice-style backend separation with ML isolation.

---

# ğŸ“‚ Project Structure

```
AETHERION_BACKEND/
â”‚
â”œâ”€â”€ django_core/        # Django + MySQL (Control Tower)
â”œâ”€â”€ fastapi_market/     # FastAPI + MongoDB (Async Market Engine)
â”œâ”€â”€ flask_regime/       # Flask (HMM Regime Engine)
â”œâ”€â”€ shared/             # Shared utilities (future use)
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

# âš™ï¸ Environment Setup

## 1ï¸âƒ£ Create Virtual Environment

```
python -m venv venv
venv\Scripts\activate
```

## 2ï¸âƒ£ Install Dependencies

```
pip install -r requirements.txt
```

---

# ğŸ“¦ requirements.txt (Updated to Day 5)

```
# Core Frameworks
Django
djangorestframework
fastapi
uvicorn
flask

# Databases
mysqlclient
mysql-connector-python
motor

# ML Stack
numpy
pandas
scikit-learn
hmmlearn
joblib

# HTTP & Async
httpx
requests
websockets

# Utilities
python-dotenv
loguru
pyotp
certifi
python-certifi-win32

# Broker SDK
smartapi-python
```

---

# ğŸ—„ Database Configuration

## MySQL (Django Core + Regime Storage)

Create databases:

```
CREATE DATABASE aetherion_core;
CREATE DATABASE aetherion;
```

Regime Table (Day 5):

```
CREATE TABLE regime_state (
    id INT AUTO_INCREMENT PRIMARY KEY,
    market VARCHAR(50) NOT NULL,
    symbol VARCHAR(50) NOT NULL,
    timeframe VARCHAR(10) NOT NULL,
    regime VARCHAR(20) NOT NULL,
    confidence FLOAT NOT NULL,
    state INT NOT NULL,
    detected_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

Add indexes for performance:

```
CREATE INDEX idx_market_symbol_time
ON regime_state (market, symbol, detected_at);

CREATE INDEX idx_regime
ON regime_state (regime);
```

---

## MongoDB (FastAPI Market)

Runs locally:

```
mongodb://localhost:27017
```

Collections:

```
market_ticks
market_candles
market_features
crypto_orderbook
us_orderbook
nse_orderbook
```

---

# â–¶ Running the Services

## Django Core (Port 8000)

```
cd django_core
python manage.py runserver 8000
```

---

## FastAPI Market (Port 8001)

```
uvicorn fastapi_market.main:app --port 8001
```

Swagger:

```
http://127.0.0.1:8001/docs
```

---

## Flask Regime (Port 8002)

```
python -m flask_regime.app
```

---

# ğŸ”„ Inter-Service Communication

FastAPI â†’ Flask Regime Detection:

```
POST http://127.0.0.1:8002/detect_regime
```

Response:

```
{
  "market": "CRYPTO",
  "symbol": "BTCUSDT",
  "regime": "Bull",
  "confidence": 0.87,
  "state": 2
}
```

---

# ğŸ“Š Day 2 â€” Market Data Simulator

## Features

â€¢ Random-walk price generator
â€¢ Volume simulation
â€¢ 1-second tick interval
â€¢ MongoDB persistence
â€¢ WebSocket streaming
â€¢ 10-second OHLC aggregation

WebSocket:

```
ws://127.0.0.1:8001/ws/market
```

---

# ğŸ§  Day 3 â€” Feature Engine

â€¢ Rolling volatility
â€¢ Log returns
â€¢ ATR
â€¢ Volume delta
â€¢ Spread estimation
â€¢ Mongo feature storage

Collection:

```
market_features
```

---

# ğŸ¤– Day 4 â€” HMM Regime Model

â€¢ Gaussian Hidden Markov Model
â€¢ 4 States â†’ Bull / Bear / Sideways / Crisis
â€¢ Feature scaling (StandardScaler)
â€¢ Automatic state mapping
â€¢ Model persistence (joblib)

Saved Artifacts:

```
crypto_1m_hmm.pkl
crypto_1m_scaler.pkl
crypto_1m_mapping.pkl
```

---

# ğŸš€ Day 5 â€” Live Regime Engine

## Polling System

FastAPI polls Flask every 10 seconds:

â€¢ Applies confidence threshold
â€¢ Inserts only on regime change
â€¢ Stores in MySQL
â€¢ Broadcasts via WebSocket

---

## Regime WebSocket

```
ws://127.0.0.1:8001/ws/regime
```

Streams:

```
{
  "market": "CRYPTO",
  "symbol": "BTCUSDT",
  "regime": "Sideways",
  "confidence": 0.76,
  "state": 1,
  "timestamp": "..."
}
```

---

# ğŸ“¡ REST Endpoints

```
GET /api/market/snapshot/{market}
GET /api/market/trades/{market}
GET /api/market/orderbook/{market}
GET /api/market/features/{market}
GET /api/market/status
```

---

# ğŸ§  What Has Been Achieved (Day 1â€“5)

âœ” Microservice backend separation
âœ” Async multi-market ingestion
âœ” Mongo feature engineering layer
âœ” HMM-based regime classification
âœ” Confidence-filtered regime transitions
âœ” MySQL historical regime storage
âœ” WebSocket real-time regime streaming
âœ” Production-style polling architecture

AETHERION now includes:

Market Engine â†’ Feature Layer â†’ Regime ML â†’ Database Persistence â†’ WebSocket Streaming

This forms the base for:

Strategy Engine â†’ Risk Layer â†’ Execution Engine â†’ Surveillance System

---

# ğŸš€ Current Status

AETHERION Backend

Day 1: COMPLETE
Day 2: COMPLETE
Day 3: COMPLETE
Day 4: COMPLETE
Day 5: COMPLETE

Live multi-market ingestion + ML regime detection operational.
